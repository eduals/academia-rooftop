{# Página de Perfil do Franqueado - Portal Rooftop #}
{% if request_contact.is_logged_in and request.contact.contact_vid %}
  {% set contact_id = request.contact.contact_vid %}
{% else %}
  {% set contact_id = 133645175296 %}
{% endif %}

{# Carrega os dados do contato/franqueado #}
{% if contact_id %}
  {% set contato = crm_object("contact", contact_id, "endereco_de_entrega_do_material_impresso, cnpj_do_franqueado,firstname,lastname,email,phone,foto_de_perfil,hs_object_id,createdate,lastmodifieddate") %}
{% else %}
  {% set contato = null %}
{% endif %}

<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Perfil do Franqueado - {{ contato.firstname }} {{ contato.lastname }}</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f8fafc; }
        .card { background-color: white; border-radius: 0.75rem; border: 1px solid #e2e8f0; box-shadow: 0 1px 2px 0 rgb(0 0 0 / 0.05); }
        .btn { display: inline-flex; align-items: center; justify-content: center; padding: 0.5rem 1rem; border-radius: 0.5rem; font-weight: 600; font-size: 0.875rem; transition: all 0.2s ease-in-out; cursor: pointer; }
        .btn-primary { background-color: #2563eb; color: white; border: 1px solid transparent; }
        .btn-primary:hover { background-color: #1d4ed8; }
        .btn-secondary { background-color: white; color: #475569; border: 1px solid #cbd5e1; }
        .btn-secondary:hover { background-color: #f8fafc; }
        .btn-icon { padding: 0.5rem; }
        .btn-ghost { background-color: transparent; color: #64748b; border: none; }
        .btn-ghost:hover { background-color: #f1f5f9; color: #334155; }
        .form-input, .form-select { width: 100%; border: 1px solid #cbd5e1; border-radius: 0.5rem; padding: 0.625rem 0.75rem; font-size: 0.875rem; transition: all 0.2s ease-in-out; }
        .form-input:focus, .form-select:focus { outline: 2px solid transparent; outline-offset: 2px; border-color: #3b82f6; box-shadow: 0 0 0 2px #bfdbfe; }
        .badge { display: inline-flex; align-items: center; padding: 0.25rem 0.75rem; border-radius: 9999px; font-size: 0.75rem; font-weight: 600; line-height: 1; }
        .badge-success { background-color: #dcfce7; color: #166534; }
        .badge-warning { background-color: #fef9c3; color: #854d0e; }
        .badge-danger { background-color: #fee2e2; color: #991b1b; }
        .badge-info { background-color: #e0f2fe; color: #0369a1; }
        .badge-gray { background-color: #f1f5f9; color: #475569; }
    </style>
</head>
<body>
  <section data-module="perfilModule" class="perfil-module max-w-4xl mx-auto">
    <!-- Loading State -->
    <div class="perfil-loading" style="display: none;">
      <div class="flex items-center justify-center py-20">
        <div class="w-16 h-16 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"></div>
        <p class="ml-4 text-lg font-semibold text-slate-700">Carregando perfil...</p>
      </div>
    </div>

    <!-- Error State -->
    <div class="perfil-error" style="display: none;">
      <div class="flex flex-col items-center justify-center py-16 text-center">
        <svg class="h-16 w-16 text-red-400 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path></svg>
        <h3 class="mb-2 text-xl font-semibold text-slate-900">Ops! Algo deu errado</h3>
        <p class="mb-6 text-slate-500 max-w-sm">Não conseguimos carregar o perfil. Por favor, tente novamente.</p>
        <button onclick="window.location.reload()" class="btn btn-primary">Tentar novamente</button>
      </div>
    </div>

    <!-- Content: Será preenchido pelo JS -->
    <div class="perfil-content" style="display: none;"></div>

    <!-- Not Found State -->
    <div class="perfil-not-found" style="display: none;">
       <div class="flex flex-col items-center justify-center py-16 text-center">
        <svg class="h-16 w-16 text-slate-400 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
        <h3 class="mb-2 text-xl font-semibold text-slate-900">Perfil não encontrado</h3>
        <p class="mb-6 text-slate-500 max-w-sm">O perfil solicitado não existe ou você não tem permissão para vê-lo.</p>
        <button onclick="window.location.href='/dashboard'" class="btn btn-primary">Voltar para dashboard</button>
      </div>
    </div>
  </section>

  <script>
    window.hubspotContatoData = {
      success: {% if contato %}true{% else %}false{% endif %},
      data: {% if contato %}{{ contato|tojson }}{% else %}null{% endif %},
      contactId: {{ contact_id|tojson }},
      timestamp: new Date().toISOString()
    };
  </script>
</body>
</html>
