{# Portal de Conte√∫dos - M√≥dulo HubSpot com HubDB Direto #}

{# ‚úÖ INICIALIZA√á√ÉO SIMPLES - APENAS CONTACT ID #}
<script>
console.log('üîß Inicializando Portal de Conte√∫dos...');

// Inicializar apenas com contact_id
window.portalConteudosData = {
  contact_id: {% if request.contact.contact_vid %}{{ request.contact.contact_vid }}{% else %}'133645175296'{% endif %},
  initialized: false
};

console.log('‚úÖ Contact ID definido:', window.portalConteudosData.contact_id);
</script>

{# Contact ID j√° foi definido no script acima #}

{# Os dados ser√£o carregados via API HubDB pelo module.js #}

<!-- Header do Portal -->
<header class="bg-white shadow-sm">
  <div class="mx-auto max-w-7xl px-4 py-4 sm:px-6 lg:px-8 sm:py-6">
    <div class="flex flex-col gap-4 sm:flex-row sm:justify-between sm:items-center">
      <div class="min-w-0 flex-1">
        <h1 class="text-2xl sm:text-3xl font-bold text-gray-900 truncate">Portal de Conte√∫dos</h1>
        <p class="mt-1 sm:mt-2 text-sm sm:text-base text-gray-600">Acesse todos os materiais, treinamentos e recursos da Rooftop Franquias</p>
      </div>
      <!-- <div class="flex-shrink-0">
        <button 
          id="btn-solicitar-material" 
          class="w-full sm:w-auto flex items-center justify-center gap-2 bg-blue-600 text-white px-4 sm:px-6 py-2 sm:py-3 rounded-lg hover:bg-blue-700 transition-colors cursor-pointer text-sm sm:text-base"
          onclick="window.portalConteudosModule.abrirModalSolicitacao()"
        >
          <svg class="h-4 w-4 sm:h-5 sm:w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
          </svg>
          <span class="hidden sm:inline">Solicitar Material</span>
          <span class="sm:hidden">Solicitar</span>
        </button>
      </div> -->
    </div>
  </div>
</header>

<!-- Container Principal -->
<main>
  <section data-module="portalConteudosModule" class="portal-conteudos-module">
    <div class="mx-auto max-w-7xl">
      
      <!-- Se√ß√£o de Debug (oculta por padr√£o) -->
      <div class="debug-section hidden" style="background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 8px; padding: 15px; margin-bottom: 15px;">
        <h3 style="color: #495057; margin-bottom: 10px; font-size: 14px;">üîç Debug Logs - Portal de Conte√∫dos</h3>
        <div id="debug-logs-container">
          <p style="color: #6c757d; font-size: 12px;">Logs ser√£o exibidos aqui conforme o processamento...</p>
        </div>
      </div>

      <!-- Estados de Error -->
      <div class="conteudos-error" style="display: none;">
        <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 sm:p-12 text-center">
          <div class="text-red-400 mb-4">
            <svg class="h-10 w-10 sm:h-12 sm:w-12 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
          </div>
          <h3 class="text-base sm:text-lg font-medium text-gray-900 mb-2">Erro ao carregar conte√∫dos</h3>
          <p class="text-sm sm:text-base text-gray-600 mb-6 sm:mb-8">Tente recarregar a p√°gina ou entre em contato com o suporte.</p>
          <button onclick="window.location.reload()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 cursor-pointer text-sm sm:text-base">
            Tentar Novamente
          </button>
        </div>
      </div>

      <!-- Estado de Loading -->
      <div class="conteudos-loading" style="display: none;">
        <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 sm:p-12 text-center">
          <div class="animate-spin rounded-full h-6 w-6 sm:h-8 sm:w-8 border-b-2 border-blue-600 mx-auto mb-4"></div>
          <p class="text-sm sm:text-base text-gray-600">Carregando conte√∫dos...</p>
          <p class="text-xs sm:text-sm text-gray-500 mt-1">Processando dados do HubDB...</p>
        </div>
      </div>

      <!-- Estado Sem Contact ID -->
      <div class="conteudos-no-contact" style="display: none;">
        <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 sm:p-12 text-center">
          <div class="text-amber-500 mb-4">
            <svg class="h-10 w-10 sm:h-12 sm:w-12 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-3.582 8-8 8a8.013 8.013 0 01-7-4c0-4.418 3.582-8 8-8s8 3.582 8 8z" />
            </svg>
          </div>
          <h3 class="text-base sm:text-lg font-medium text-gray-900 mb-2">Login Necess√°rio</h3>
          <p class="text-sm sm:text-base text-gray-600 mb-4 sm:mb-6">Para acessar os conte√∫dos, √© necess√°rio fazer login no portal.</p>
          <button onclick="window.location.href='/login'" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 cursor-pointer text-sm sm:text-base">
            Fazer Login
          </button>
        </div>
      </div>

      <!-- Conte√∫do Principal -->
      <div class="conteudos-content" style="display: none;">
        <!-- O conte√∫do ser√° inserido dinamicamente pelo JavaScript -->
      </div>

    </div>
  </section>
</main>

<!-- Estilos CSS -->
<style>
  @keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.5; }
  }
  
  .animate-pulse {
    animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
  }

  @keyframes spin {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
  }
  
  .animate-spin {
    animation: spin 1s linear infinite;
  }

  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .cursor-pointer {
    cursor: pointer;
  }

  /* Utilit√°rios Tailwind essenciais */
  .hidden { display: none !important; }
  .block { display: block !important; }
  .flex { display: flex; }
  .items-center { align-items: center; }
  .justify-between { justify-between: space-between; }
  .gap-2 { gap: 0.5rem; }
  .gap-3 { gap: 0.75rem; }
  .gap-4 { gap: 1rem; }
  .text-sm { font-size: 0.875rem; }
  .text-xs { font-size: 0.75rem; }
  .font-medium { font-weight: 500; }
  .font-semibold { font-weight: 600; }
  .text-gray-500 { color: #6b7280; }
  .text-gray-600 { color: #4b5563; }
  .text-gray-700 { color: #374151; }
  .text-blue-600 { color: #2563eb; }
  .bg-blue-50 { background-color: #eff6ff; }
  .bg-green-50 { background-color: #f0fdf4; }
  .bg-red-50 { background-color: #fef2f2; }
  .border { border-width: 1px; }
  .border-gray-200 { border-color: #e5e7eb; }
  .rounded-lg { border-radius: 0.5rem; }
  .p-2 { padding: 0.5rem; }
  .p-4 { padding: 1rem; }
  .px-2 { padding-left: 0.5rem; padding-right: 0.5rem; }
  .py-1 { padding-top: 0.25rem; padding-bottom: 0.25rem; }
  .mb-4 { margin-bottom: 1rem; }
  .mt-2 { margin-top: 0.5rem; }
  .w-full { width: 100%; }
  .transition-colors { transition-property: color, background-color, border-color; }
</style>

<script>
// ‚úÖ INICIALIZA√á√ÉO MAIS DIRETA POSS√çVEL
(function() {
  console.log('üéØ Inicializa√ß√£o do Portal de Conte√∫dos...');
  
  // Fun√ß√£o para tentar inicializar
  function tentar() {
    if (window.portalConteudosModule && typeof window.portalConteudosModule.init === 'function') {
      console.log('‚úÖ Portal de Conte√∫dos inicializado com contact_id:', window.portalConteudosData.contact_id);
      window.portalConteudosModule.init();
      return true;
    }
    return false;
  }
  
  // Tentar imediatamente
  if (tentar()) return;
  
  // Se n√£o funcionou, aguardar DOM + √∫nica tentativa com delay
  document.addEventListener('DOMContentLoaded', function() {
    if (tentar()) return;
    
    // √öltima tentativa ap√≥s 500ms
    setTimeout(function() {
      if (!tentar()) {
        console.warn('‚ö†Ô∏è Portal de Conte√∫dos n√£o p√¥de ser inicializado automaticamente');
        console.log('üîç window.portalConteudosModule:', typeof window.portalConteudosModule);
      }
    }, 500);
  });
})();
</script>