{# Detalhe do Conte√∫do - M√≥dulo HubSpot #}

<script>
// ‚úÖ INICIALIZAR DADOS NO WINDOW ANTES DO PROCESSAMENTO
window.detalheConteudoData = {
  contact_id: null,
  content_id: null,
  module_id: null,
  debug_logs: [],
  initialized: false
};

// Fun√ß√£o para adicionar logs de debug
window.addDetalheDebugLog = function(etapa, mensagem, dados) {
  window.detalheConteudoData.debug_logs.push({
    etapa: etapa,
    mensagem: mensagem,
    dados: dados || null,
    timestamp: new Date().toISOString()
  });
  console.log('üîç DETALHE CONTE√öDO - ETAPA ' + etapa + ' - ' + mensagem, dados);
};
</script>

{% if true %}
{# {% if request_contact.is_logged_in and request.contact.contact_vid %} #}
  {% set contact_id = request.contact.contact_vid || '133645175296' %}
  {% set content_id = request.query_dict.content_id || request.query_dict.id || '194772914700' %}
  {% set module_id = request.query_dict.module_id || '194772915311' %}
  
  <script>
    window.addDetalheDebugLog(1, 'Contact ID, Content ID e Module ID identificados', {
      contact_id: '{{contact_id}}',
      content_id: '{{content_id}}',
      module_id: '{{module_id}}'
    });
    window.detalheConteudoData.contact_id = '{{contact_id}}';
    window.detalheConteudoData.content_id = '{{content_id}}';
    window.detalheConteudoData.module_id = '{{module_id}}';
    window.detalheConteudoData.initialized = true;
  </script>

{% else %}
  <script>
    window.addDetalheDebugLog(0, 'Usu√°rio n√£o logado - Detalhe do Conte√∫do', null);
    window.detalheConteudoData = {
      contact_id: null,
      content_id: null,
      debug_logs: [],
      initialized: false
    };
  </script>
{% endif %}

<!-- Container Principal -->
<main>
  <section data-module="detalheConteudoModule" class="mx-auto max-w-7xl px-4 py-6 detalhe-conteudo-module">
    
    <!-- Se√ß√£o de Debug (oculta por padr√£o) -->
    <div class="debug-section hidden" style="background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 8px; padding: 15px; margin-bottom: 15px;">
      <h3 style="color: #495057; margin-bottom: 10px; font-size: 14px;">üîç Debug Logs - Detalhe do Conte√∫do</h3>
      <div id="debug-logs-container">
        <p style="color: #6c757d; font-size: 12px;">Logs ser√£o exibidos aqui conforme o processamento...</p>
      </div>
    </div>

    <!-- Estados de Error -->
    <div class="conteudo-error" style="display: none;">
      <div class="min-h-screen bg-gray-50 flex items-center justify-center">
        <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 sm:p-12 text-center max-w-md mx-auto">
          <div class="text-red-400 mb-4">
            <svg class="h-10 w-10 sm:h-12 sm:w-12 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
          </div>
          <h3 class="text-base sm:text-lg font-medium text-gray-900 mb-2">Erro ao carregar conte√∫do</h3>
          <p class="text-sm sm:text-base text-gray-600 mb-6 sm:mb-8">O conte√∫do solicitado n√£o foi encontrado ou est√° indispon√≠vel.</p>
          <div class="flex flex-col sm:flex-row gap-3">
            <button onclick="window.location.reload()" class="flex-1 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 cursor-pointer text-sm sm:text-base">
              Tentar Novamente
            </button>
            <button onclick="history.back()" class="flex-1 bg-gray-200 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-300 cursor-pointer text-sm sm:text-base">
              Voltar
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Estado de Loading -->
    <div class="conteudo-loading" style="display: none;">
      <div class="min-h-screen bg-gray-50 flex items-center justify-center">
        <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 sm:p-12 text-center max-w-md mx-auto">
          <div class="animate-spin rounded-full h-6 w-6 sm:h-8 sm:w-8 border-b-2 border-blue-600 mx-auto mb-4"></div>
          <p class="text-sm sm:text-base text-gray-600">Carregando conte√∫do...</p>
          <p class="text-xs sm:text-sm text-gray-500 mt-1">Preparando o v√≠deo...</p>
        </div>
      </div>
    </div>

    <!-- Estado Sem ID -->
    <div class="conteudo-no-id" style="display: none;">
      <div class="min-h-screen bg-gray-50 flex items-center justify-center">
        <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 sm:p-12 text-center max-w-md mx-auto">
          <div class="text-amber-500 mb-4">
            <svg class="h-10 w-10 sm:h-12 sm:w-12 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-3.582 8-8 8a8.013 8.013 0 01-7-4c0-4.418 3.582-8 8-8s8 3.582 8 8z" />
            </svg>
          </div>
          <h3 class="text-base sm:text-lg font-medium text-gray-900 mb-2">Conte√∫do n√£o especificado</h3>
          <p class="text-sm sm:text-base text-gray-600 mb-6">√â necess√°rio especificar qual conte√∫do voc√™ deseja visualizar.</p>
          <button onclick="history.back()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 cursor-pointer text-sm sm:text-base">
            Voltar ao Portal
          </button>
        </div>
      </div>
    </div>

    <!-- Conte√∫do Principal -->
    <div class="conteudo-detail" style="display: none;">
      <!-- O conte√∫do ser√° inserido dinamicamente pelo JavaScript -->
    </div>
    
    <!-- Modal de Congratula√ß√µes (quando completar m√≥dulo) -->
    <div id="modal-modulo-concluido" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center z-50">
      <div class="bg-white rounded-xl p-6 sm:p-8 max-w-md mx-4 text-center">
        <div class="mb-6">
          <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
            <svg class="w-8 h-8 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
            </svg>
          </div>
        </div>
        <h2 class="text-xl sm:text-2xl font-bold text-gray-900 mb-2">M√≥dulo Conclu√≠do!</h2>
        <p class="text-sm sm:text-base text-gray-600 mb-6">
          Voc√™ completou com sucesso o m√≥dulo <span id="modulo-concluido-titulo"></span>.
        </p>
        <div class="space-y-3">
          <button
            id="btn-continuar-curso"
            class="w-full bg-blue-600 hover:bg-blue-700 text-white py-2 sm:py-3 rounded-lg transition-colors cursor-pointer text-sm sm:text-base"
          >
            Continuar Curso
          </button>
          <button
            id="btn-fechar-modal-modulo"
            class="w-full border border-gray-300 hover:bg-gray-50 text-gray-700 py-2 sm:py-3 rounded-lg transition-colors cursor-pointer text-sm sm:text-base"
          >
            Fechar
          </button>
        </div>
      </div>
    </div>
    
    <!-- Modal de Congratula√ß√µes Completa (quando completar curso inteiro) -->
    <div id="modal-curso-concluido" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center z-50">
      <div class="bg-white rounded-xl p-6 sm:p-8 max-w-md mx-4 text-center">
        <div class="mb-6">
          <div class="w-16 h-16 bg-yellow-100 rounded-full flex items-center justify-center mx-auto mb-4">
            <svg class="w-8 h-8 text-yellow-600" fill="currentColor" viewBox="0 0 24 24">
              <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z" />
            </svg>
          </div>
          <div class="flex justify-center space-x-1 mb-4">
            <svg class="w-5 h-5 text-yellow-400 fill-current" viewBox="0 0 24 24"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>
            <svg class="w-5 h-5 text-yellow-400 fill-current" viewBox="0 0 24 24"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>
            <svg class="w-5 h-5 text-yellow-400 fill-current" viewBox="0 0 24 24"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>
            <svg class="w-5 h-5 text-yellow-400 fill-current" viewBox="0 0 24 24"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>
            <svg class="w-5 h-5 text-yellow-400 fill-current" viewBox="0 0 24 24"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>
          </div>
        </div>
        <h2 class="text-xl sm:text-2xl font-bold text-gray-900 mb-2">Parab√©ns!</h2>
        <p class="text-sm sm:text-base text-gray-600 mb-6">
          Voc√™ completou com sucesso o curso <span id="curso-concluido-titulo"></span>. 
          Agora voc√™ est√° pronto para aplicar todo o conhecimento adquirido!
        </p>
        <div class="space-y-3">
          <button
            id="btn-voltar-cursos-completo"
            class="w-full bg-blue-600 hover:bg-blue-700 text-white py-2 sm:py-3 rounded-lg transition-colors cursor-pointer text-sm sm:text-base"
          >
            Voltar aos Cursos
          </button>
          <button
            id="btn-baixar-certificado"
            class="w-full border border-gray-300 hover:bg-gray-50 text-gray-700 py-2 sm:py-3 rounded-lg transition-colors cursor-pointer text-sm sm:text-base"
          >
            Baixar Certificado
          </button>
        </div>
      </div>
    </div>

  </section>
</main>

<!-- Estilos CSS -->
<style>
  /* Reset e base */
  * {
    box-sizing: border-box;
  }

  @keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.5; }
  }
  
  .animate-pulse {
    animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
  }

  @keyframes spin {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
  }
  
  .animate-spin {
    animation: spin 1s linear infinite;
  }

  /* Prevenir overflow horizontal */
  body, html {
    overflow-x: hidden;
  }

  .detalhe-conteudo-module {
    width: 100%;
    max-width: 100vw;
    overflow-x: hidden;
  }

  /* Utilit√°rios essenciais */
  .hidden { display: none !important; }
  .block { display: block !important; }
  .flex { display: flex; }
  .items-center { align-items: center; }
  .justify-center { justify-content: center; }
  .justify-between { justify-content: space-between; }
  .flex-1 { flex: 1 1 0%; }
  .flex-shrink-0 { flex-shrink: 0; }
  
  /* Layout */
  .min-h-screen { min-height: 100vh; }
  .w-full { width: 100%; }
  .h-6 { height: 1.5rem; }
  .h-8 { height: 2rem; }
  .h-10 { height: 2.5rem; }
  .w-6 { width: 1.5rem; }
  .w-8 { width: 2rem; }
  .w-10 { width: 2.5rem; }
  .max-w-md { max-width: 28rem; }
  .max-w-4xl { max-width: 56rem; }
  .mx-auto { margin-left: auto; margin-right: auto; }

  /* Flexbox responsivo */
  .flex-col { flex-direction: column; }
  @media (min-width: 640px) {
    .sm\\:flex-row { flex-direction: row; }
    .sm\\:h-8 { height: 2rem; }
    .sm\\:h-12 { height: 3rem; }
    .sm\\:w-8 { width: 2rem; }
    .sm\\:w-12 { width: 3rem; }
  }

  /* Typography */
  .text-xs { font-size: 0.75rem; }
  .text-sm { font-size: 0.875rem; }
  .text-base { font-size: 1rem; }
  .text-lg { font-size: 1.125rem; }
  .text-xl { font-size: 1.25rem; }
  .text-2xl { font-size: 1.5rem; }
  .text-3xl { font-size: 1.875rem; }
  
  @media (min-width: 640px) {
    .sm\\:text-sm { font-size: 0.875rem; }
    .sm\\:text-base { font-size: 1rem; }
    .sm\\:text-lg { font-size: 1.125rem; }
    .sm\\:text-xl { font-size: 1.25rem; }
    .sm\\:text-2xl { font-size: 1.5rem; }
    .sm\\:text-4xl { font-size: 2.25rem; }
  }

  .font-medium { font-weight: 500; }
  .font-semibold { font-weight: 600; }
  .font-bold { font-weight: 700; }

  /* Colors */
  .text-gray-500 { color: #6b7280; }
  .text-gray-600 { color: #4b5563; }
  .text-gray-700 { color: #374151; }
  .text-gray-900 { color: #111827; }
  .text-blue-500 { color: #3b82f6; }
  .text-blue-600 { color: #2563eb; }
  .text-blue-700 { color: #1d4ed8; }
  .text-blue-800 { color: #1e40af; }
  .text-white { color: #ffffff; }
  .text-red-400 { color: #f87171; }
  .text-green-600 { color: #16a34a; }
  .text-amber-500 { color: #f59e0b; }
  .text-yellow-400 { color: #facc15; }
  .text-yellow-600 { color: #ca8a04; }

  /* Backgrounds */
  .bg-white { background-color: #ffffff; }
  .bg-gray-50 { background-color: #f9fafb; }
  .bg-gray-100 { background-color: #f3f4f6; }
  .bg-gray-200 { background-color: #e5e7eb; }
  .bg-gray-300 { background-color: #d1d5db; }
  .bg-blue-50 { background-color: #eff6ff; }
  .bg-blue-100 { background-color: #dbeafe; }
  .bg-blue-600 { background-color: #2563eb; }
  .bg-blue-700 { background-color: #1d4ed8; }
  .bg-green-100 { background-color: #dcfce7; }
  .bg-yellow-100 { background-color: #fef3c7; }
  
  /* Mobile-optimized backgrounds */
  .bg-black\/50 { background-color: rgba(0, 0, 0, 0.5); }

  /* Borders */
  .border { border-width: 1px; }
  .border-gray-200 { border-color: #e5e7eb; }
  .rounded-lg { border-radius: 0.5rem; }

  /* Padding */
  .p-4 { padding: 1rem; }
  .p-6 { padding: 1.5rem; }
  .px-4 { padding-left: 1rem; padding-right: 1rem; }
  .py-2 { padding-top: 0.5rem; padding-bottom: 0.5rem; }
  .py-4 { padding-top: 1rem; padding-bottom: 1rem; }
  
  @media (min-width: 640px) {
    .sm\\:p-12 { padding: 3rem; }
  }

  /* Margin */
  .mt-1 { margin-top: 0.25rem; }
  .mb-2 { margin-bottom: 0.5rem; }
  .mb-4 { margin-bottom: 1rem; }
  .mb-6 { margin-bottom: 1.5rem; }
  
  @media (min-width: 640px) {
    .sm\\:mb-8 { margin-bottom: 2rem; }
  }

  /* Gaps */
  .gap-3 { gap: 0.75rem; }

  /* Shadows */
  .shadow-sm { box-shadow: 0 1px 2px 0 rgb(0 0 0 / 0.05); }

  /* Transitions */
  .transition-colors { 
    transition-property: color, background-color, border-color;
    transition-duration: 150ms; 
  }

  /* Hover states */
  .hover\\:bg-blue-700:hover { background-color: #1d4ed8; }
  .hover\\:bg-gray-300:hover { background-color: #d1d5db; }

  /* Text center */
  .text-center { text-align: center; }

  /* Cursor */
  .cursor-pointer { cursor: pointer; }

  /* Mobile-specific improvements */
  @media (max-width: 639px) {
    h1, h2, h3 {
      word-wrap: break-word;
      hyphens: auto;
    }
    
    button {
      min-height: 44px;
      touch-action: manipulation;
    }
  }
</style>

<script>
  // ‚úÖ AGUARDAR PROCESSAMENTO E INICIALIZAR M√ìDULO
  setTimeout(function() {
    console.log('üéØ Inicializando Detalhe do Conte√∫do com dados:', window.detalheConteudoData);
    
    // Disparar inicializa√ß√£o do m√≥dulo quando os dados estiverem prontos
    if (typeof window.detalheConteudoModule !== 'undefined') {
      window.detalheConteudoModule.init();
    }
  }, 100);
  
  // Event listeners globais para modals
  document.addEventListener('DOMContentLoaded', function() {
    // Modal de m√≥dulo conclu√≠do
    var btnContinuarCurso = document.getElementById('btn-continuar-curso');
    if (btnContinuarCurso) {
      btnContinuarCurso.addEventListener('click', function() {
        if (window.detalheConteudoModule) {
          window.detalheConteudoModule.continuarCurso();
        }
      });
    }
    
    var btnFecharModalModulo = document.getElementById('btn-fechar-modal-modulo');
    if (btnFecharModalModulo) {
      btnFecharModalModulo.addEventListener('click', function() {
        if (window.detalheConteudoModule) {
          window.detalheConteudoModule.fecharModalModulo();
        }
      });
    }
    
    // Modal de curso completo
    var btnVoltarCursosCompleto = document.getElementById('btn-voltar-cursos-completo');
    if (btnVoltarCursosCompleto) {
      btnVoltarCursosCompleto.addEventListener('click', function() {
        if (window.detalheConteudoModule) {
          window.detalheConteudoModule.voltarAosCursos();
        }
      });
    }
    
    var btnBaixarCertificado = document.getElementById('btn-baixar-certificado');
    if (btnBaixarCertificado) {
      btnBaixarCertificado.addEventListener('click', function() {
        if (window.detalheConteudoModule) {
          window.detalheConteudoModule.baixarCertificado();
        }
      });
    }
  });
</script>