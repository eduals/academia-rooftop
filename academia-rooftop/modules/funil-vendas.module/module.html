{# Relat√≥rios - Portal do Franqueado Rooftop #}
{# Busca dados de atividades para relat√≥rios #}


{% set view_contact_id = request.query_dict.view_contact_id %}
{% if view_contact_id %}
  {% set contact_id = view_contact_id %}
{% elif request_contact.is_logged_in and request.contact.contact_vid %}
  {% set contact_id = request.contact.contact_vid %}
{% else %}
  {% set contact_id = 133645175296 %}
{% endif %}

{# request_contact.is_logged_in and #}
{% if contact_id %}
  {% set relatorios_data = crm_associations(contact_id, 'HUBSPOT_DEFINED', 4, '', 'dealname,amount,dealstage,closedate,dealowner,pipeline,hs_object_id,createdate', 100) %}
{% else %}
  {% set relatorios_data = {'results': [], 'total': 0, 'has_more': false} %}
{% endif %}


<script>
  // Passar contact_id para o m√≥dulo JavaScript
  window.hubspotContactId = {% if contact_id %}'{{contact_id}}'{% else %}null{% endif %};
  console.log('üìå Contact ID capturado:', window.hubspotContactId);
  {% if view_contact_id %}
  console.log('üëÅÔ∏è Visualizando neg√≥cios do contato:', '{{view_contact_id}}');
  {% endif %}
</script>

<div class="mx-auto max-w-7xl px-4 py-6 min-h-full h-full">
  <section data-module="relatoriosModule" class="relatorios-module min-h-full h-full">
    
    <div class="relatorios-loading" style="display: none;">
      <div class="flex items-center justify-center py-16">
        <div class="bg-white rounded-lg shadow-lg p-8 max-w-md text-center">
          <div class="flex items-center justify-center mb-4">
            <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mr-3"></div>
            <span id="loading-message" class="text-lg text-gray-700 font-medium">Iniciando an√°lise...</span>
          </div>
          <div class="text-sm text-gray-500">
            <span id="loading-timer">0s</span> processando
          </div>
        </div>
      </div>
    </div>

    <div class="relatorios-error" style="display: none;">
      <div class="bg-red-50 border border-red-200 rounded-lg p-4">
        <p class="text-red-800">Erro ao carregar os dados dos relat√≥rios.</p>
      </div>
    </div>

    <div class="relatorios-content" style="display: none;">
      <!-- O conte√∫do ser√° inserido dinamicamente pelo JavaScript -->
    </div>

    <div class="relatorios-empty" style="display: none;">
      <div class="text-center py-16">
        <div class="mx-auto h-12 w-12 text-gray-400">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
          </svg>
        </div>
        <h3 class="mt-4 text-lg font-medium text-gray-900">Nenhum dado encontrado</h3>
        <p class="mt-2 text-gray-500">N√£o h√° dados de relat√≥rios dispon√≠veis no momento.</p>
      </div>
    </div>

  </section>
</div>

<script>
  window.hubspotRelatoriosData = {
    success: false,
    data: {
      relatorios: []
    },
    total: 0,
    hasMore: false,
    timestamp: new Date().toISOString(),
    source: 'mock_data'
  }; 

  console.log('HubSpot Relat√≥rios Data loaded:', window.hubspotRelatoriosData);
</script>